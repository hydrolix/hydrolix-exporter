# Hydrolix Exporter

<!-- status autogenerated section -->
| Status        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------- |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stability     | [beta]: metrics, traces, logs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Distributions | []                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aexporter%2Fhydrolix%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aexporter%2Fhydrolix) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aexporter%2Fhydrolix%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aexporter%2Fhydrolix) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=exporter_hydrolix)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=exporter_hydrolix&displayType=list)                                                                                                                                                                                                                                                                                                                                                                                                                           |

[beta]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
<!-- end autogenerated section -->

This exporter supports sending OpenTelemetry metrics, traces, and logs to [Hydrolix](https://www.hydrolix.io/).

Hydrolix is a cloud-native data platform designed for high-volume, high-velocity log and event data. It provides efficient data ingestion and querying capabilities optimized for observability data.

## Configuration

The following configuration options are supported:

- `endpoint` (required): The Hydrolix ingest endpoint URL.
- `hdx_table` (required): The Hydrolix table name where data will be written.
- `hdx_transform` (required): The Hydrolix transform to apply to incoming data.
- `hdx_bearer_token` (optional): Bearer token for authentication. Takes precedence if both token and username/password are provided.
- `hdx_username` (optional): Username for Basic Authentication.
- `hdx_password` (optional): Password for Basic Authentication.
- `timeout` (optional): HTTP client timeout. Default is 30s.

**Note**: You must provide either `hdx_bearer_token` OR both `hdx_username` and `hdx_password` for authentication.

### Example Configuration

**Using Bearer Token (recommended):**
```yaml
hydrolix/metrics:
  endpoint: https://your-hydrolix-cluster.hydrolix.io/ingest/event
  hdx_table: your.table.name
  hdx_transform: your_transform
  hdx_bearer_token: ${env:HYDROLIX_BEARER_TOKEN}
```

**Using Basic Authentication:**
```yaml
hydrolix/metrics:
  endpoint: https://your-hydrolix-cluster.hydrolix.io/ingest/event
  hdx_table: your.table.name
  hdx_transform: your_transform
  hdx_username: ${env:HYDROLIX_USERNAME}
  hdx_password: ${env:HYDROLIX_PASSWORD}
```

## Data Model

### Metrics

The exporter sends metrics with the following fields:
- Metric name, description, and unit
- Metric type (gauge, sum, histogram, exponential histogram, summary)
- Timestamp and values
- Service name and resource attributes as flat key-value objects
- Metric-specific attributes as flat key-value objects
- Optional trace context (traceId, spanId) extracted from metric attributes

### Traces

The exporter sends traces (spans) with the following fields:
- Trace ID, span ID, and parent span ID
- Span name and kind
- Start time and duration
- Status code and message
- Service name and resource attributes as flat key-value objects
- Span attributes as flat key-value objects
- Span events (logs attached to spans)

### Logs

The exporter sends logs with the following fields:
- Timestamp and observed timestamp
- Severity number and text
- Log body
- Service name and resource attributes as flat key-value objects
- Log attributes as flat key-value objects
- Optional trace context (traceId, spanId, traceFlags)
- HTTP-specific attributes (status code, route, method)

### Attribute Format

All attributes (tags, serviceTags, scope_attributes) are exported as flat JSON objects for efficient querying:

```json
{
  "tags": {
    "http.method": "GET",
    "http.status_code": "200"
  },
  "serviceTags": {
    "service.name": "api-gateway",
    "service.version": "1.2.3"
  }
}
```

## Example Pipeline Configuration

```yaml
receivers:
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318
      grpc:
        endpoint: 0.0.0.0:4317

processors:
  batch:
    timeout: 10s
    send_batch_size: 1024

exporters:
  hydrolix/traces:
    endpoint: https://your-hydrolix-cluster.hydrolix.io/ingest/event
    hdx_table: myorg.spans
    hdx_transform: tf_otel_spans
    hdx_bearer_token: ${env:HYDROLIX_BEARER_TOKEN}
    timeout: 30s

service:
  pipelines:
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [hydrolix/traces]
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [hydrolix/traces]
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [hydrolix/traces]
```

## Authentication

The exporter supports two authentication methods:

### Bearer Token Authentication (Recommended)

Uses a bearer token for authentication. If `hdx_bearer_token` is provided, it takes precedence over username/password.

```yaml
exporters:
  hydrolix/traces:
    hdx_bearer_token: ${env:HYDROLIX_BEARER_TOKEN}
```

### Basic Authentication

Uses username and password for HTTP Basic Authentication. This is used as a fallback when no bearer token is provided.

```yaml
exporters:
  hydrolix/traces:
    hdx_username: ${env:HYDROLIX_USERNAME}
    hdx_password: ${env:HYDROLIX_PASSWORD}
```

**Note**: It is recommended to use environment variables for sensitive credentials.

## Headers

The exporter sets the following HTTP headers on each request:
- `Content-Type: application/json`
- `x-hdx-table`: The configured table name
- `x-hdx-transform`: The configured transform name
- `Authorization`: Either `Bearer <token>` or Basic Authentication credentials

## Best Practices

1. **Use the batch processor**: Always include the batch processor in your pipeline to improve performance and reduce the number of HTTP requests.

2. **Monitor error responses**: The exporter logs detailed error messages including Hydrolix response bodies to help with troubleshooting.

3. **Secure credentials**: Use environment variables or secret management systems to store Hydrolix credentials.

4. **Configure appropriate timeouts**: Adjust the `timeout` setting based on your network conditions and data volume.

5. **Test connectivity**: Verify your Hydrolix endpoint is accessible and credentials are correct before deploying to production.

## Deployment instructions

1. Pull the image from GCP

    ```bash
    docker pull us-docker.pkg.dev/hdx-art/t/hdx-collector:1.0.0
    ```

1. Create a config file

   Copy the hydrolix-config.yaml from this repo and update it with your url,
   tables and transforms.

1. Add service account credentials

   Create a [service account](https://docs.hydrolix.io/latest/self-managed/advanced-configuration/authentication-and-authorization/account-types/service-accounts-howto/)
   in your Hydrolix cluster and add the credentials to docker.

1. Deploying the collector
    1. [Option 1] [Kubernetes deployment](KUBERNETES_DEPLOYMENT.md)
    1. [Option 2] [RPM deployment](RPM_DEPLOYMENT.md) - For RHEL/CentOS/Fedora systems

    1. [Option 3] Run the image manually

       Export the environment variables
        ``` 
          export HYDROLIX_BEARER_TOKEN=token here
        ```

        ```bash 
        docker run --name otel-collector -p 4317:4317 \
          -p 4318:4318 \
          -e HYDROLIX_BEARER_TOKEN \
          -v [Absolute path to your otel config]:/etc/otelcol/config.yaml \
          us-docker.pkg.dev/hdx-art/t/hdx-collector:1.0.0
        ```

    1. [Option 4] Docker compose

       Docker compose can read environment variables from the system
       environment variables.
        ``` 
       # docker-compose.yml
        version: '3.8'
        services:
        otel-collector:
        image: otelcol-hydrolix:latest
        container_name: otel-collector
        ports:
        - "4317:4317"
        - "4318:4318"
        environment:
        - HYDROLIX_BEARER_TOKEN=${HYDROLIX_BEARER_TOKEN}
        # or use env_file:
        env_file:
        - .env
        volumes:
        - ./local.yaml:/etc/otelcol/config.yaml
        ```